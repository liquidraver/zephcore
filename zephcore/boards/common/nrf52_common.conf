# nRF52 Platform Configuration
# Included by all nRF52-based boards (RAK4631, Wio Tracker, T1000-E, Ikoka Nano, etc.)
# Only contains nRF52-specific settings — common BLE/Storage/Input is in zephcore_common.conf
#
# Include order: prj.conf → zephcore_common.conf → nrf52_common.conf → <board>/board.conf

# ========== Build Output (nRF52 specific) ==========
CONFIG_BUILD_OUTPUT_UF2=y
CONFIG_USE_DT_CODE_PARTITION=y

# ========== USB CDC ACM (nRF52 USB) ==========
CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_CDC_ACM_SERIAL_INITIALIZE_AT_BOOT=y
CONFIG_CDC_ACM_SERIAL_PRODUCT_STRING="ZephCore"
CONFIG_UART_LINE_CTRL=y

# ========== BLE: nRF52-specific controller settings ==========
# TX power: +4 dBm (Zephyr open-source BLE controller)
CONFIG_BT_CTLR_TX_PWR_PLUS_4=y

# Data Length Extension — controller-side max (host-side in zephcore_common.conf)
CONFIG_BT_CTLR_DATA_LENGTH_MAX=251

# Coded PHY — enable in nRF LL controller (host auto-request in zephcore_common.conf)
CONFIG_BT_CTLR_PHY_CODED=y

# ========== Flash: nRF52-specific ==========
# Partial erase — splits 4KB page erase into small sub-erases that fit
# between BLE connection events.  Without this, the flash driver waits for
# an ~85ms gap in BLE activity (ticker sync) which never comes during an
# active connection, freezing the system on the first flash write.
CONFIG_SOC_FLASH_NRF_PARTIAL_ERASE=y

# QSPI flash — disabled by default (safer — avoids hang if chip missing).
# Boards with QSPI (Wio Tracker L1) override in board.conf.
CONFIG_NORDIC_QSPI_NOR=n

# ========== Storage: Arduino MeshCore compatible layout ==========
# BLE bonds via file-based settings on InternalFS (replaces NVS).
# Required for Arduino MeshCore flash layout compatibility — the NVS region
# (0xD4000-0xD6000) is now part of ExtraFS.
CONFIG_NVS=n
CONFIG_SETTINGS_NVS=n
CONFIG_SETTINGS_FILE=y
CONFIG_SETTINGS_FILE_PATH="/ifs/settings"

# ========== SEGGER RTT (J-Link debug) ==========
# RTT log backend is in boards/common/logging.conf (only included for debug builds).
CONFIG_USE_SEGGER_RTT=y
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=4096

# ========== Debug ==========
CONFIG_ASSERT=y
CONFIG_BT_CTLR_ASSERT_HANDLER=y
